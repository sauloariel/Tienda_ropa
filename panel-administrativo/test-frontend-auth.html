<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend Auth</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>
    <h1>Test Frontend Authentication</h1>
    <button onclick="testLogin()">Test Login</button>
    <button onclick="testMe()">Test /auth/me</button>
    <div id="output"></div>

    <script>
        const API_URL = 'http://localhost:4000';
        let currentToken = null;

        function log(message) {
            const output = document.getElementById('output');
            output.innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }

        async function testLogin() {
            try {
                log('üîê Probando login...');
                const response = await axios.post(`${API_URL}/auth/login`, {
                    usuario: 'admin',
                    password: 'admin123'
                });

                log('‚úÖ Login exitoso: ' + JSON.stringify(response.data, null, 2));
                currentToken = response.data.token;
                log('üîë Token guardado: ' + currentToken.substring(0, 20) + '...');

            } catch (error) {
                log('‚ùå Error en login: ' + error.message);
                if (error.response) {
                    log('Status: ' + error.response.status);
                    log('Data: ' + JSON.stringify(error.response.data));
                }
            }
        }

        async function testMe() {
            if (!currentToken) {
                log('‚ùå No hay token, haz login primero');
                return;
            }

            try {
                log('üîç Probando /auth/me...');
                const response = await axios.get(`${API_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                log('‚úÖ /auth/me exitoso: ' + JSON.stringify(response.data, null, 2));

            } catch (error) {
                log('‚ùå Error en /auth/me: ' + error.message);
                if (error.response) {
                    log('Status: ' + error.response.status);
                    log('Data: ' + JSON.stringify(error.response.data));
                    log('Headers: ' + JSON.stringify(error.response.headers));
                }
            }
        }
    </script>
</body>

</html>